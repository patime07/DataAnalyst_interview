with table_1 as 
(
SELECT age_bucket, 
  SUM(CASE WHEN activity_type = 'open' THEN time_spent ELSE 0 END) AS open_total,
  SUM(CASE WHEN activity_type = 'send' THEN time_spent ELSE 0 END) AS sending_total
FROM activities 
LEFT JOIN age_breakdown ON activities.user_id = age_breakdown.user_id
GROUP BY age_bucket
)

select age_bucket, round ((sending_total/(open_total+sending_total)) * 100.0 ,2) as send_perc , round((open_total/(open_total+sending_total)) * 100.0 ,2) as open_perc
from table_1
