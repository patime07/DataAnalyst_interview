with cat_prod_tot as(
select category, product, sum(spend) as cat_prod_total
from product_spend
where extract(year from transaction_date) = '2022'
group by category, product
),
 cat_prod_tot_rank as (
 select category, product, row_number() over(partition by category order by cat_prod_total desc) as rank,
 cat_prod_total
 from cat_prod_tot
 )

select category, product, cat_prod_total
from cat_prod_tot_rank
where rank = 1 or rank = 2
